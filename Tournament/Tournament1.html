<html>
<head>
<link rel=STYLESHEET TYPE="text/css" href="../stylesheets/common.css">

<script>

// 12/30/2018:  Added support for starting semi finals and finals - no commit of playoff data exists yet.
//
// TODO - definitely want to add protection for clear all (make them confirm that all data is to be destroyed).

window.onload = initialPageLoad;

function initialPageLoad()
{
}

var tournamentsList = new Array();
var tournament = new Object();
var playersList = new Array();
var matchesList = new Array();
var playoffMatchesList = new Array();

// This clears both localStorage and tournamentData stored in global form objects.
function clearAllLocalStorage()
{
    localStorage.clear();
    
    tournamentsList = new Array();
    tournament = new Object();
    playersList = new Array();
    matchesList = new Array();    
    playoffMatchesList = new Array();
    
    document.getElementById("appDebuggingData").innerHTML = "";
    
    displayTournament();
}

function dumpAllGlobalData()
{
    var output = "";
    
    output += "<br>tournamentsList=" + getAsJsonString(tournamentsList);
    output += "<br>tournament=" + getAsJsonString(tournament);
    output += "<br>playersList=" + getAsJsonString(playersList);
    output += "<br>matchesList=" + getAsJsonString(matchesList);
    output += "<br>playoffMatchesList=" + getAsJsonString(playoffMatchesList);

    document.getElementById("appDebuggingData").innerHTML = output;  
}

function getAllLocalStorage() 
{
    var keys = Object.keys(localStorage);
    var output = "";
        
    keys.forEach(function(item, index, array) 
    {
        output += "<br>key=" + item + ", value=" + localStorage.getItem(item);
    });

    document.getElementById("appDebuggingData").innerHTML = output;    
    
    return output;
}

function getLocalStorageTournamentsList()
{
    var localStorageTournamentsListAsJsonStr = localStorage.getItem("TOURNAMENTS_LIST");
    
    if (localStorageTournamentsListAsJsonStr === null)
    {
        tournamentsList = new Array();
    }
    else {
        tournamentsList = getObjFromJsonString(localStorageTournamentsListAsJsonStr);
    }
    
    return tournamentsList;
}

function setLocalStorageTournamentsList()
{
    var tournamentsListAsJsonStr =  getAsJsonString(tournamentsList);
        
    localStorage.setItem("TOURNAMENTS_LIST", getAsJsonString(tournamentsList));
}

function getLocalStorageTournament(compositeKey)
{
    var localStorageTournamentAsJsonStr = localStorage.getItem("TOURNAMENT_" + compositeKey);
    
    if (localStorageTournamentAsJsonStr === null)
    {
        return null;
    }
    else {
        return getObjFromJsonString(localStorageTournamentAsJsonStr);
    }
}

function setLocalStorageTournament()
{
    localStorage.setItem("TOURNAMENT_" + tournament.compositeKey, getAsJsonString(tournament));
}

function getLocalStoragePlayersList(compositeKey)
{
    var localStoragePlayersAsJsonStr = localStorage.getItem("PLAYERS_" + compositeKey);
    
    if (localStoragePlayersAsJsonStr == null)
    {
        return new Array();
    }
    
    return getObjFromJsonString(localStoragePlayersAsJsonStr);
}

function setLocalStoragePlayersList()
{
    localStorage.setItem("PLAYERS_" + tournament.compositeKey, getAsJsonString(playersList));
}

function getLocalStorageMatchesList(compositeKey)
{
    var localStorageMatchesAsJsonStr = localStorage.getItem("MATCHES_" + compositeKey);
    
    if (localStorageMatchesAsJsonStr == null)
    {
        return new Array();
    }
    
    return getObjFromJsonString(localStorageMatchesAsJsonStr);
}

function setLocalStorageMatchesList()
{
    localStorage.setItem("MATCHES_" + tournament.compositeKey, getAsJsonString(matchesList));
}

function clearExistingTournament(compositeKey)
{
    localStorage.removeItem("MATCHES_" + compositeKey);
    matchesList = new Array();
   
    localStorage.removeItem("PLAYERS_" + compositeKey);
    playersList = new Array();
}


function getObjFromJsonString(jsonStr)
{
    var obj = JSON.parse(jsonStr);
    return obj;
} 

function getAsJsonString(obj)
{
    var myJSON = JSON.stringify(obj);
    return myJSON;
}

function verifyTournamentCompositeKey(compositeKey)
{
    var validityStr = "";
    
    if (compositeKey == null || compositeKey == "")
    {
        validityStr = "Composite key is not defined - it should be of the form: skillLevel:poolNum";
    }
    else {
        var strParts = compositeKey.split(":");
        
        if (strParts.length != 2)
        {
            validityStr = "Composite key '" + compositeKey + "' has invalid number of tokens - it should be of the form: skillLevel:poolNum";
        }
        else {
            if (strParts[0].length == 0)
            {
                validityStr = "Composite key  '" + compositeKey + "'  has invalid format (skillLevel is not supplied) - it should be of the form: skillLevel:poolNum";
            }
            else
            if (strParts[1].length == 0)
            {
                validityStr = "Composite key '" + compositeKey + "'  has invalid format (poolNum is not supplied) - it should be of the form: skillLevel:poolNum";
            }             
        }
    }
    
    return validityStr;
}

function verifyTournamentPlayers(tournamentPlayersString)
{
    var validityStr = "";
    
    if (tournamentPlayersString == null || tournamentPlayersString == "")
    {
        validityStr = "Tournament players is not defined - it should be of the form: playerName1,playerName2,...,playerName8";
    }
    else {
        var strParts = tournamentPlayersString.split(",");
        
        if (strParts.length < 3 || strParts.length > 8)
        {
            validityStr = "Tournament players are invalid - list must be between 3 and 8 (i.e., playerName1,playerName2,...,playerName8)";
        }
    }
    
    return validityStr;
}

function createTournament(compositeKey, tournamentPlayersString, nbrOfGamesToWinMatch)
{
    tournament = new Object();
    tournament.compositeKey = compositeKey;
    tournament.state = 1;   // 1 - players registered but tournament not started (no matches are scheduled)
    tournament.nbrOfGamesToWinMatch = nbrOfGamesToWinMatch;
    tournament.nbrOfnbrOfPlayoffRounds = 0;  // Won't set a real default until players are assigned and qualifying round is started.
    
    createPlayersList(tournamentPlayersString);  // Constructs and loads playersMap
    matchesList = new Array();
    
    return tournament;
}

function createPlayersList(tournamentPlayersString) 
{ 
    playersList = new Array();

    var tournamentPlayerNamesArray = tournamentPlayersString.split(",");
      
    var tournamentPlayerRankingNum = 0;
      
    tournamentPlayerNamesArray.forEach(function(item, index, array) 
    {
        tournamentPlayerRankingNum++;
        var tournamentPlayerObj = createTournamentPlayer(item, tournamentPlayerRankingNum);
        playersList.push(tournamentPlayerObj);
    }); 
    
    return playersList;
}


//=========================================================================================================================================
// Tournament initialization ivolves giving the user an opportunity to either add a new tournament compositeKey or selecting from 
// an existing one.   The user will also be allowed to add or change players associated with the tournament.   This will result
// in the following two global objects being loaded into memory:  
//   tournament
//   playersList
//=========================================================================================================================================
function initializeTournament()
{
    getLocalStorageTournamentsList();
    
    var compositeKey = "";
    
    if (tournamentsList.length == 0)
    {
        compositeKey = prompt("No tournaments have been started, please enter skillLevel:poolNum.", "");
    }
    else {
        var compositeKeys = "";
        
        tournamentsList.forEach(function(item, index, array) 
        {
            if (compositeKeys.length > 0) {
                compositeKeys += ",";
            }
            compositeKeys += item;
        });    
    
        compositeKey = prompt("Some tournaments have already been started, please limit to a single skillLevel:poolNum or enter a completely new skillLevel:pool.", compositeKeys);    
    }
    
    if (compositeKey == null || compositeKey == "") 
    {
        alert("User aborted, no tournament will be started or resumed!");
        return;
    }
    else {
        var validityStr = verifyTournamentCompositeKey(compositeKey);
    
        if (validityStr.length > 0)
        {
            alert(validityStr);
            return;
        }        
    
        var existingTournament = getLocalStorageTournament(compositeKey);
    
        if (existingTournament != null)
        {
            resumeExistingTournament(existingTournament);
            return;
        }
        
        var tournamentPlayersString = prompt("Please enter player names.  Names should be offered in comma separated list (and be in seeded order)", tournamentPlayersString);    

        validityStr = verifyTournamentPlayers(tournamentPlayersString);
        
        if (validityStr.length > 0)
        {
            alert(validityStr);
            return;
        }              

        var userData = prompt("Please enter number of games needed to win a qualifying round match (must be 1, 2, or 3)", "2");
        var nbrOfGamesToWinMatch = Number(userData);
        
        if (isNaN(userData) || userData == null || userData == "" || nbrOfGamesToWinMatch < 1 || nbrOfGamesToWinMatch > 3)
        {
            alert("Invalid number of games to win match, must be between 1 and 3 (default is 2).")
            return;
        }
        
        createTournament(compositeKey, tournamentPlayersString, nbrOfGamesToWinMatch);
            
        tournamentsList.push(tournament.compositeKey);
            
        setLocalStorageTournamentsList();
            
        setLocalStorageTournament();
            
        setLocalStoragePlayersList();
            
        alert("Tournament: '" + compositeKey + "' created for players: '" + tournamentPlayersString + "'. \nWhen ready, user may start the tournament (this will trigger the scheduling of qualifying round matches).");
    }
    
    displayTournament();
}

function resumeExistingTournament(existingTournament)
{
    tournament = existingTournament;
    
    if (tournament.state > 1)
    {
        matchesList = getLocalStorageMatchesList(tournament.compositeKey);
    }
    else {
        matchesList = new Array();  // If tournament hasn't started yet, then there should be no scheduled matches.
    }   
   
    if (tournament.state == 1)  // If no matches have been scheduled, allow user to change the list of players
    {
        playersList = getLocalStoragePlayersList(tournament.compositeKey);
    
        var tournamentPlayersString = "";
        var newTournamentPlayersString = "";
        
        playersList.forEach(function(item, index, array) 
        {
            if (tournamentPlayersString.length > 0) {
                tournamentPlayersString += ",";
            }
            tournamentPlayersString += item.name
        });     

        newTournamentPlayersString = prompt("Please adjust or confirm tournament player names.  Names should be offered in comma separated list (and be in seeded order)", tournamentPlayersString);    

        validityStr = verifyTournamentPlayers(newTournamentPlayersString);
        
        if (validityStr.length > 0)
        {
            alert(validityStr);
            return;
        }
        
        // Check to see if players list has changed - if so, build new players list and apply to local storage
        if (newTournamentPlayersString != tournamentPlayersString)
        {
            createPlayersList(newTournamentPlayersString);  // Constructs and loads playersMap
            
            setLocalStoragePlayersList();
        }
    }

    playersList = getLocalStoragePlayersList(tournament.compositeKey);
    
    displayTournament();    
}

//=========================================================================================================================================
// Starting a tournament is when the qualifying round matches are scheduled.   This method will change the state of the tournament to
// 1-TOURNAMENT_STARTED and will schedule the qualifying round matches based on the number of players that are registered.  Once this method
// is done, global matchesList will be loaded.   Once the matches are scheduled, they cannot be "re-scheduled".  There actually is no reason
// to reschedule unless user wants to add a player - and if that is necessary, the user would have to clear the tournament and start over.
//=========================================================================================================================================
function startTournament() 
{            
    if (tournament.state != 1) 
    {
        alert("Tournament cannot be started because it is in an invalid state - should be 1-INITIALIZED, but is instead in: " + getTournamentStateLabel());
        return;
    }
     
    if (playersList.length == 3) 
    {
        start3PersonTournament();    
    }
    else
    if (playersList.length == 4) 
    {
        start4PersonTournament();
    }
    else
    if (playersList.length == 5) 
    {
        start5PersonTournament();
    }
    else
    if (playersList.length == 6) 
    {
        start6PersonTournament();
    }
    else
    if (playersList.length == 7) 
    {
        start7PersonTournament();
    }
    else
    if (playersList.length == 8) 
    {
        start8PersonTournament();
    }
    
    tournament.state = 2;   // TOURNAMENT_STARTED (maches are now scheduled - user can now enter game scores).
    
    if (playersList.lengh < 6)
    {
        tournament.nbrOfPlayoffRounds = 1;  // Small number of players don't require 2 round playoffs (this is only a default)
    }
    else {
        tournament.nbrOfPlayoffRounds = 2;  // Larger number of players benefit from 2 round playoffs (this is only a default) 
    }
    
    setLocalStorageTournament();

    setLocalStorageMatchesList();
    
    displayTournament();
}

function start3PersonTournament()
{
    var matchObj;
    
    var matchNum = 1;
    var matchType = 1;   // QUALIFYING-ROUND
    
    matchObj = createMatch(tournament.compositeKey, matchNum++, matchType, 
                           playersList[0],   // 1st seed
                           playersList[1]);  // 2nd seed
    matchesList.push(matchObj);
    
    matchObj = createMatch(tournament.compositeKey, matchNum++, matchType,
                           playersList[0],   // 1st seed
                           playersList[2]);  // 3rd seed    
    matchesList.push(matchObj);

    matchObj = createMatch(tournament.compositeKey, matchNum++, matchType, 
                           playersList[1],   // 2nd seed
                           playersList[2]);  // 3rd seed    
    matchesList.push(matchObj);
}

function start4PersonTournament()
{
    var matchObj;
    
    var matchNum = 1;
    var matchType = 1;   // QUALIFYING-ROUND
    
    matchObj = createMatch(tournament.compositeKey, matchNum++, matchType, 
                           playersList[0],   // 1st seed
                           playersList[1]);  // 2nd seed
    matchesList.push(matchObj);
    
    matchObj = createMatch(tournament.compositeKey, matchNum++, matchType,
                           playersList[2],   // 3rd seed
                           playersList[3]);  // 4th seed    
    matchesList.push(matchObj);

    matchObj = createMatch(tournament.compositeKey, matchNum++, matchType, 
                           playersList[0],   // 1st seed
                           playersList[2]);  // 3rd seed    
    matchesList.push(matchObj);

    matchObj = createMatch(tournament.compositeKey, matchNum++, matchType,
                           playersList[1],   // 2nd seed
                           playersList[3]);  // 4th seed
    matchesList.push(matchObj);
}

function start5PersonTournament()
{
    var matchObj;
    
    var matchNum = 1;
    var matchType = 1;   // QUALIFYING-ROUND
    
    matchObj = createMatch(tournament.compositeKey, matchNum++, matchType, 
                           playersList[0],   // 1st seed
                           playersList[1]);  // 2nd seed
    matchesList.push(matchObj);
    
    matchObj = createMatch(tournament.compositeKey, matchNum++, matchType,
                           playersList[2],   // 3rd seed
                           playersList[4]);  // 5th seed    
    matchesList.push(matchObj);

    matchObj = createMatch(tournament.compositeKey, matchNum++, matchType, 
                           playersList[1],   // 2nd seed
                           playersList[3]);  // 4th seed    
    matchesList.push(matchObj);

    matchObj = createMatch(tournament.compositeKey, matchNum++, matchType,
                           playersList[0],   // 1st seed
                           playersList[2]);  // 3rd seed
    matchesList.push(matchObj);

    matchObj = createMatch(tournament.compositeKey, matchNum++, matchType, 
                           playersList[3],   // 4th seed
                           playersList[4]);  // 5th seed
    matchesList.push(matchObj);
}

function start6PersonTournament()
{
    var matchObj;
    
    var matchNum = 1;
    var matchType = 1;   // QUALIFYING-ROUND
    
    matchObj = createMatch(tournament.compositeKey, matchNum++, matchType, 
                           playersList[0],   // 1st seed
                           playersList[2]);  // 3rd seed
    matchesList.push(matchObj);
    
    matchObj = createMatch(tournament.compositeKey, matchNum++, matchType, 
                           playersList[1],   // 2nd seed
                           playersList[3]);  // 4th seed    
    matchesList.push(matchObj);
    
    matchObj = createMatch(tournament.compositeKey, matchNum++, matchType, 
                           playersList[4],   // 5th seed
                           playersList[5]);  // 6th seed
    matchesList.push(matchObj); 

    matchObj = createMatch(tournament.compositeKey, matchNum++, matchType,
                           playersList[0],   // 1st seed
                           playersList[5]);  // 6th seed    
    matchesList.push(matchObj);

    matchObj = createMatch(tournament.compositeKey, matchNum++, matchType,
                           playersList[1],   // 2nd seed
                           playersList[4]);  // 5th seed
    matchesList.push(matchObj);

    matchObj = createMatch(tournament.compositeKey, matchNum++, matchType, 
                           playersList[2],   // 3rd seed
                           playersList[3]);  // 4th seed
    matchesList.push(matchObj); 
}

function start7PersonTournament()
{   
    var matchObj;
    
    var matchNum = 1;
    var matchType = 1;   // QUALIFYING-ROUND
    
    matchObj = createMatch(tournament.compositeKey, matchNum++, matchType,
                           playersList[0],   // 1st seed
                           playersList[3]);  // 4th seed
    matchesList.push(matchObj);
    
    matchObj = createMatch(tournament.compositeKey, matchNum++, matchType,
                           playersList[1],   // 2nd seed
                           playersList[2]);  // 3rd seed    
    matchesList.push(matchObj);
    
    matchObj = createMatch(tournament.compositeKey, matchNum++, matchType,
                           playersList[0],   // 1st seed
                           playersList[4]);  // 5th seed
    matchesList.push(matchObj); 

    matchObj = createMatch(tournament.compositeKey, matchNum++, matchType,
                           playersList[1],   // 2nd seed
                           playersList[5]);  // 6th seed    
    matchesList.push(matchObj);

    matchObj = createMatch(tournament.compositeKey, matchNum++, matchType,
                           playersList[2],   // 3rd seed
                           playersList[6]);  // 7th seed
    matchesList.push(matchObj);

    matchObj = createMatch(tournament.compositeKey, matchNum++, matchType,  
                           playersList[4],   // 5th seed
                           playersList[5]);  // 6th seed
    matchesList.push(matchObj); 
    
    matchObj = createMatch(tournament.compositeKey, matchNum++, matchType, 
                           playersList[3],   // 4th seed
                           playersList[6]);  // 7th seed
    matchesList.push(matchObj);     
}

function start8PersonTournament()
{
    var matchObj;
    
    var matchNum = 1;
    var matchType = 1;   // QUALIFYING-ROUND
    
    matchObj = createMatch(tournament.compositeKey, matchNum++, matchType, 
                           playersList[0],   // 1st seed
                           playersList[2]);  // 3rd seed
    matchesList.push(matchObj);
    
    matchObj = createMatch(tournament.compositeKey, matchNum++, matchType, 
                           playersList[0],   // 1st seed
                           playersList[5]);  // 6th seed    
    matchesList.push(matchObj);
        
    matchObj = createMatch(tournament.compositeKey, matchNum++, matchType, 
                           playersList[1],   // 2nd seed
                           playersList[3]);  // 4th seed
    matchesList.push(matchObj);
    
    matchObj = createMatch(tournament.compositeKey, matchNum++, matchType, 
                           playersList[1],   // 2nd seed
                           playersList[4]);  // 5th seed
    matchesList.push(matchObj); 
    
    matchObj = createMatch(tournament.compositeKey, matchNum++, matchType, 
                           playersList[2],   // 3rd seed
                           playersList[7]);  // 8th seed
    matchesList.push(matchObj); 

    matchObj = createMatch(tournament.compositeKey, matchNum++, matchType,
                           playersList[3],   // 4th seed
                           playersList[6]);  // 7th seed    
    matchesList.push(matchObj);

    matchObj = createMatch(tournament.compositeKey, matchNum++, matchType, 
                           playersList[4],   // 5th seed
                           playersList[7]);  // 8th seed    
    matchesList.push(matchObj);
    
    matchObj = createMatch(tournament.compositeKey, matchNum++, matchType,
                           playersList[5],   // 6th seed
                           playersList[6]);  // 7th seed    
    matchesList.push(matchObj); 
}

function createMatch(compositeKey, matchNum, matchType, tournamentPlayer1, tournamentPlayer2)
{    
    var matchObj = new Object();
    
    matchObj.compositeKey = compositeKey;
    matchObj.matchNum = matchNum;
    matchObj.matchType = matchType;
    matchObj.player1Name = tournamentPlayer1.name;
    matchObj.player1Seed = tournamentPlayer1.tournamentSeedingNum;
    matchObj.player2Name = tournamentPlayer2.name;
    matchObj.player2Seed = tournamentPlayer2.tournamentSeedingNum;
    
    matchObj.gameScores = new Array();
    matchObj.gameScoresString = "";
    
    initializeMatchStats(matchObj);
    
    return matchObj;
}

function initializeMatchStats(matchObj)
{
    matchObj.player1MatchWinCnt = 0;
    matchObj.player1GameDiff = 0;
    matchObj.player1PointDiff = 0;  
    matchObj.player1GamesWon = 0;
    matchObj.player1DerivedQualifyingScore = 0;
    
    matchObj.player2MatchWinCnt = 0;
    matchObj.player2GameDiff = 0;
    matchObj.player2GamesWon = 0;    
    matchObj.player2PointDiff = 0;    
    matchObj.player2DerivedQualifyingScore = 0; 
}

function finalizeQualifyingRoundMatches()
{
    matchesList.forEach(function(item, index, array) 
    {
        summarizeMatchGames(item);
    });
    
    var errorString = "";
    
    matchesList.forEach(function(item, index, array) 
    {
        if (item.player1MatchWinCnt == 0 && item.player2MatchWinCnt == 0)
        {
            if (errorString.length > 0) {
                errorString += ", ";
            }
            errorString += "\nMatch '" + item.matchNum + "' isn't complete";
        }
    });

    if (errorString.length > 0)
    {
        alert("Cannot finalize qualifying round because not all matches have been completed." + errorString);
        return errorString;
    }
    
    deriveQualifierRoundRanking();
        
    return "";   // Everything okay.
}

// Adds bonus points to players with 1 win where the player beat another player with 1 win.
function applyTieBreakPointsToPlayerStats(matchObj)
{
    var player1 = playersList[matchObj.player1Seed - 1];  // This works because players are added to playersList in seeded order.

    if (player1.qualifyingRoundWinCnt == 1 &&   // Player 1 has exactly 1 win
        matchObj.player1MatchWinCnt == 1)       // Player 1 won the match, so check if bonus points are needed
    {
        var opponentPlayer = playersList[matchObj.player2Seed - 1];

        if (opponentPlayer.qualifyingRoundWinCnt == 1)  // Bonus points apply to player that beat this player
        {
            player1.derivedQualifyingScore += 1000;
        }
    }

    var player2 = playersList[matchObj.player2Seed - 1];  // This works because players are added to playersList in seeded order.

    if (player2.qualifyingRoundWinCnt == 1 &&   // Player 1 has exactly 1 win
        matchObj.player2MatchWinCnt == 1)       // Player 1 won the match, so check if bonus points are needed
    {
        var opponentPlayer = playersList[matchObj.player1Seed - 1];
        
        if (opponentPlayer.qualifyingRoundWinCnt == 1)  // Bonus points apply to player that beat this player
        {
            player2.derivedQualifyingScore += 1000;
        }
    } 
}

function deriveQualifierRoundRanking()
{
    playersList.forEach(function(item, index, array) 
    {
        initializePlayerStats(item);  // Reset player stats back to 0 so they can be summarized across all matches (done next)
    });    

    matchesList.forEach(function(item, index, array) 
    {
        applyMatchResultsToPlayerStats(item);  // Summarizes stats across matches for the players related to the the given match
    });
    
    matchesList.forEach(function(item, index, array) 
    {
        applyTieBreakPointsToPlayerStats(item); // Adds bonus points to players with 1 win where the player beat another player with 1 win.
    });    
}

function initializePlayerStats(player)
{
    player.qualifyingRoundWinCnt = 0;
    player.gameDiff = 0;
    player.pointDiff = 0;
    player.derivedQualifyingScore = 0;  
    player.strengthOfScheduled = 0;
}

function applyMatchResultsToPlayerStats(matchObj)
{
    var player1 = playersList[matchObj.player1Seed - 1];  // This works because players are added to playersList in seeded order.

    player1.qualifyingRoundWinCnt += matchObj.player1MatchWinCnt;
    player1.gameDiff += matchObj.player1GameDiff;
    player1.pointDiff += matchObj.player1PointDiff;
    player1.derivedQualifyingScore += matchObj.player1DerivedQualifyingScore;
    player1.strengthOfScheduled += matchObj.player2Seed;

    var player2 = playersList[matchObj.player2Seed - 1];  // This works because players are added to playersList in seeded order.

    player2.qualifyingRoundWinCnt += matchObj.player2MatchWinCnt;
    player2.gameDiff += matchObj.player2GameDiff;
    player2.pointDiff += matchObj.player2PointDiff;
    player2.derivedQualifyingScore += matchObj.player2DerivedQualifyingScore;
    player2.strengthOfScheduled += matchObj.player1Seed;    
}

function summarizeMatchGames(matchObj)
{
    initializeMatchStats(matchObj);

    matchObj.gameScores.forEach(function(item, index, array) 
    {
        matchObj.player1GameDiff += item.player1GameDiff;
        matchObj.player2GameDiff += item.player2GameDiff;

        matchObj.player1PointDiff += item.player1PointDiff;
        matchObj.player2PointDiff += item.player2PointDiff;
        
        if (item.player1GameDiff > 0) 
        {
            matchObj.player1GamesWon++;
        }
        if (item.player2GameDiff > 0) 
        {
            matchObj.player2GamesWon++;
        }        
    });
    
    if (matchObj.player1GamesWon > tournament.nbrOfGamesToWinMatch || matchObj.player2GamesWon > tournament.nbrOfGamesToWinMatch)
    {
        var errorString = "Too many games played - number of games to win a match is: " + tournament.nbrOfGamesToWinMatch;
        alert(errorString)
        return errorString;
    }
    
    if (matchObj.player1GamesWon == tournament.nbrOfGamesToWinMatch && matchObj.player2GamesWon == tournament.nbrOfGamesToWinMatch)
    {
        var errorString = "Both players cannot win match - number of games to win a match is: " + tournament.nbrOfGamesToWinMatch;
        alert(errorString)
        return errorString;
    }    
    
    if (matchObj.player1GamesWon == tournament.nbrOfGamesToWinMatch)
    {
        matchObj.player1MatchWinCnt++;
    }
    
    if (matchObj.player2GamesWon == tournament.nbrOfGamesToWinMatch)
    {
        matchObj.player2MatchWinCnt++;
    }
    
    if (matchObj.matchType == 1 && matchObj.gameScores.length > 0)   // 1-Qualifier, 2-Semis, 3-Finals
    {
        // Leaving 1000 multiplier for tie breaker bonus points.
        matchObj.player1DerivedQualifyingScore = (matchObj.player1MatchWinCnt * 10000) + (matchObj.player1GameDiff * 100) + matchObj.player1PointDiff;
        matchObj.player2DerivedQualifyingScore = (matchObj.player2MatchWinCnt * 10000) + (matchObj.player2GameDiff * 100) + matchObj.player2PointDiff;
    }
    
    return "";   // Everything okay
}

// Will validate the user entered gameScoresString - if valid, it will replace the gameScores array in the match object.
// If invalid, no update to matches will be done, and errorMessage will be returned.
function processGameScores(matchObj, gameScoresString)
{
    var gameScoreError = "";
    var alertErrorString = "";
    
    var gameScoresArray;
    var newGamesArray = new Array();    
    
    if (gameScoresString.length > 0)
    {
        gameScoresArray = gameScoresString.split(",");
      
        if (gameScoresArray.length > 5)
        {
            alertErrorString = "Invalid game scores '" + gameScoresString + "', no more than 5 games are allowed.";
            alert (alertErrorString);
            return alertErrorString;    
        }
      
        var gameNumber = 1;
    
        gameScoresArray.forEach(function(item, index, array) 
        {
            var gameScoreParts = item.split("-");
        
            if (gameScoreParts.length != 2)
            {
                alertErrorString = "Invalid game scores '" + gameScoresString + "', game number '" + gameNumber + "' is not valid, must be like 11-9";
                alert (alertErrorString);
                return alertErrorString;
            }
        
            gameScoreError = validateGameScore(Number(gameScoreParts[0]), Number(gameScoreParts[1]));
        
            if (gameScoreError.length > 0) 
            {
                alertErrorString = "Invalid game scores '" + gameScoresString + "', game number '" + gameNumber + "', " + gameScoreError;
                alert (alertErrorString);
                return alertErrorString;
            }
        
            newGame = createGameScore(gameNumber, Number(gameScoreParts[0]), Number(gameScoreParts[1]));
            newGamesArray.push(newGame);
        
            gameNumber++;
        }); 
    }
    
    if (alertErrorString.length == 0)
    {
        // summarizeMatchGames function can potentially return an error because user may have entered more games than allowed.
        // On error, restore matchObj to prior state (can merely reprocess the original gamescores string - that must be valid);

        var originalGameScoresString = matchObj.gameScoresString;
        var originalGameScores = matchObj.gameScores;
        
        matchObj.gameScores = newGamesArray;
        matchObj.gameScoresString = gameScoresString;

        var errorString = summarizeMatchGames(matchObj); 
        
        if (errorString.length > 0)
        {
            matchObj.gameScoresString = originalGameScoresString;
            matchObj.gameScores = originalGameScores;
            
            summarizeMatchGames(matchObj);   // This better not fail (it shouldn't).
        }
    }

    return alertErrorString;
}

function validateGameScore(player1Score, player2Score)
{
    if (isNaN(player1Score) || isNaN(player2Score))
    {
        return "Invalid game score - not valid numbers.";    
    }

    if (player1Score < 11 && player2Score < 11) 
    {
        return "Invalid game score - no player reached 11.";
    }
    
    var scoreDiff = player1Score - player2Score;

    if (Math.abs(scoreDiff) < 2) 
    {
        return "Invalid game score - must win by at least 2 points.";
    }
    
    if (player1Score > 11 || player2Score > 11)
    {
        if (Math.abs(scoreDiff) != 2)
        {
            return "Deuce matches must be decided by exactly 2 points.";    
        }
    }

    return "";   // Everything is okay!
}

function createGameScore(gameNum, player1Score, player2Score)
{
    var gameObj = new Object();
    
    gameObj.gameNum = gameNum;
    gameObj.player1Score = player1Score;
    gameObj.player2Score = player2Score;
    
    if (player1Score > player2Score)
    {
        gameObj.player1GameDiff = 1;
        gameObj.player2GameDiff = -1;
    }
    else {
        gameObj.player1GameDiff = -1;
        gameObj.player2GameDiff = 1;
    }
    
    gameObj.player1PointDiff = player1Score - player2Score;
    gameObj.player2PointDiff = player2Score - player1Score;
    
    return gameObj;
}

function createTournamentPlayer(name, tournamentSeedingNum)
{
    var tournamentPlayerObj = new Object();
    
    tournamentPlayerObj.name = name;
    tournamentPlayerObj.tournamentSeedingNum = tournamentSeedingNum;
    tournamentPlayerObj.qualifyingRoundWinCnt = 0;
    tournamentPlayerObj.gameDiff = 0;
    tournamentPlayerObj.pointDiff = 0;
    tournamentPlayerObj.derivedQualifyingScore = 0;    
    
    return tournamentPlayerObj;
}

function displayTournament()
{
    document.getElementById("appDebuggingData").innerHTML = "";  // Just in case it was displayed.

    deriveQualifierRoundRanking();
    
    var output = "";

    output += "<br>Tournament category: " + tournament.compositeKey;
    output += "<br>Tournament progress: " + getTournamentStateLabel();
    output += "<br>Qualifying round games to win match: " + tournament.nbrOfGamesToWinMatch;
    
    if (tournament.nbrOfPlayoffRounds != 0)
    {
        output += "<br>Number of playoff rounds (default): " + tournament.nbrOfPlayoffRounds;    
    }

    document.getElementById("tournamentData").innerHTML = output;    
    
    output = getPlayersAsHTML();
    document.getElementById("playerData").innerHTML = output;    
    
    displayMatchesOnForm();
    
    displayPlayoffs();
}

// States:
//   1 - Initialized (players registered)
//   2 - Started (qualifying round matches scheduled)
//   3 - Semi finals started - only applies for 2 round playoff
//   4 - Finals started (applies to both 1 and 2 round playoff format)
//   5 - Tournament closed (final round playoff scores entered - final ranking published)
function getTournamentStateLabel()
{
    var output = "";
    
    if (tournament.state == 1) {
        return "1-INITIALIZED"
    }
    else
    if (tournament.state == 2) {
        return "2-QUALIFYING ROUND STARTED"    
    }
    else
    if (tournament.state == 3) {
        return "3-SEMI FINALS STARTED"
    }
    else
    if (tournament.state == 4) {
        return "4-FINALS STARTED"    
    }
    else
    if (tournament.state == 1) {
        return "5-TOURNAMENT CLOSED"    
    }
    
    return "UNKNOWN_STATE (some sort of application error occurred)."
}

function getPlayersAsHTML()
{
    var output = "<br><b>Players</b>";
    
    output += "<ul>";  // Indentation
    
    output += "<table cellspacing='10'><tr><td><u>Starting seed #</u></td> <td><u>Name</u></td> <td><u>Qualifying round wins</u></td> <td><u>Game diff (+/-)</u></td> <td><u>Point diff (+/-)</u></td> <td><u>Qualifying round ranking</u></td> <td><u>Strength of schedule</u></td> </tr>";

    playersList.forEach(function(item, index, array) 
    {
        output += "<tr>";

        output += "<td>";
        output += item.tournamentSeedingNum;
        output += "</td>";

        output += "<td>";
        output += item.name;
        output += "</td>";

        output += "<td>";
        output += item.qualifyingRoundWinCnt;
        output += "</td>"; 

        output += "<td>";
        output += item.gameDiff;
        output += "</td>";
        
        output += "<td>";
        output += item.pointDiff;
        output += "</td>";        
        
        output += "<td>";
        output += item.derivedQualifyingScore;
        output += "</td>"; 
        
        output += "<td>";
        output += item.strengthOfScheduled;
        output += "</td>"; 
        
        output += "</tr>";
    });
    
    output += "</table>";
    output += "</ul>";
    
    return output;
}

function displayMatchesOnForm()
{
    var players;
    var cellId;
    
    matchesList.forEach(function(item, index, array) 
    {
        players = "";
        cellId = "Match" + item.matchNum + "Cell1";
        document.getElementById(cellId).innerHTML = item.matchNum;    

        cellId = "Match" + item.matchNum + "CellMatchType";
        document.getElementById(cellId).innerHTML = getMatchTypeAsString(item.matchType);
        
        players += getPlayer1NameForMatch(item);
        players += " - ";
        players += getPlayer2NameForMatch(item);
        
        cellId = "Match" + item.matchNum + "CellPlayers";
        document.getElementById(cellId).innerHTML = players;    

        cellId = "Match" + item.matchNum + "CellScore";
        document.getElementById(cellId).innerHTML = item.gameScoresString;    
    });
    
    // Clear any match data that is beyond the number of scheduled matches (basically clearing residue data)
    for (i = matchesList.length + 1; i < 9; i++) 
    {
        cellId = "Match" + i + "Cell1";
        document.getElementById(cellId).innerHTML = "";    

        cellId = "Match" + i + "CellMatchType";
        document.getElementById(cellId).innerHTML = "";       
        
        cellId = "Match" + i + "CellPlayers";
        document.getElementById(cellId).innerHTML = "";    

        cellId = "Match" + i + "CellScore";
        document.getElementById(cellId).innerHTML = "";      
    }
}

function displayPlayoffs()
{
    if (tournament.state < 3)
    {
        return;
    }

    playoffMatchesList.forEach(function(item, index, array) 
    {
        displayPlayoffMatch(item, index+1);          
    });    
}

function displayPlayoffMatch(matchObj, matchNum)
{
    var players = "";
    var cellId; 
    
    cellId = "PlayoffMatch" + matchNum + "Cell1";
    document.getElementById(cellId).innerHTML = "P" + matchNum;    

    cellId = "PlayoffMatch" + matchNum + "MatchType";
    document.getElementById(cellId).innerHTML = getMatchTypeAsString(matchObj.matchType);
        
    players += getPlayer1NameForMatch(matchObj);
    players += " - ";
    players += getPlayer2NameForMatch(matchObj);
        
    cellId = "PlayoffMatch" + matchNum + "CellPlayers";
    document.getElementById(cellId).innerHTML = players;    

    cellId = "PlayoffMatch" + matchNum + "CellScore";
    document.getElementById(cellId).innerHTML = matchObj.gameScoresString; 
}


function getPlayer1NameForMatch(matchObj)
{
    if (matchObj.player1MatchWinCnt == 1)
    {
        return "<b><u>" + matchObj.player1Name + "</u></b>";    
    }

    if (matchObj.player1GameDiff > 0)
    {
        return "<b>" + matchObj.player1Name + "</b>";
    }
    
    return matchObj.player1Name;
}

function getPlayer2NameForMatch(matchObj)
{
    if (matchObj.player2MatchWinCnt == 1)
    {
        return "<b><u>" + matchObj.player2Name + "</u></b>";    
    }

    if (matchObj.player2GameDiff > 0)
    {
        return "<b>" + matchObj.player2Name + "</b>";
    }
    
    return matchObj.player2Name;
}

function getMatchTypeAsString(matchType)
{
    if (matchType == 1) {
        return "QUALIFIER";
    }
    else
    if (matchType == 2) {
        return "CONSOLATION";
    }
    else
    if (matchType == 3) {
        return "SEMI FINALS";
    }
    else {
        return "FINALS";
    }
    
    return "UNKNOWN MATCH_TYPE (application error)";
}


// Note that matchNum is actual number (from user's perspective), and not 0 based offset.
function managePlayoffMatchScores(matchNum)
{    
    if (playoffMatchesList.length >= matchNum)
    {
        matchObj = playoffMatchesList[matchNum - 1];
        var newGameScoresString = prompt("Match '" + getPlayoffMatchTitle(matchObj, matchNum) + "' game scores (comma separated list, scores separated by dash - e.g., 11-9, 8-11).", 
                                         matchObj.gameScoresString);

        if (newGameScoresString == null)  // User hit cancel on prompt
        {
            alert("Game scores have not changed (user aborted action).");
            return;
        }
                
        if (newGameScoresString != matchObj.gameScoresString) 
        {            
            var errorString = processGameScores(matchObj, newGameScoresString)

            if (errorString.length > 0)
            {
                return;
            }

            displayTournament();
        }
        else {
            alert("Game scores have not changed");
        }  
    }
}

// Note that matchNum is actual number (from user's perspective), and not 0 based offset.
function manageQualifyingRoundMatchScores(matchNum)
{    
    if (matchesList.length >= matchNum)
    {
        matchObj = matchesList[matchNum - 1];
        var newGameScoresString = prompt("Match '" + getMatchTitle(matchObj) + "' game scores (comma separated list, scores separated by dash - e.g., 11-9, 8-11).", 
                                         matchObj.gameScoresString);

        if (newGameScoresString == null)  // User hit cancel on prompt
        {
            alert("Game scores have not changed (user aborted action).");
            return;
        }
                
        if (newGameScoresString != matchObj.gameScoresString) 
        {            
            var errorString = processGameScores(matchObj, newGameScoresString)

            if (errorString.length > 0)
            {
                return;
            }
            
            setLocalStorageMatchesList();
            
            deriveQualifierRoundRanking();   // Need to apply all matches to all players - delta updates are too difficult.
            
            displayTournament();
        }
        else {
            alert("Game scores have not changed");
        }  
    }
}

function getMatchTitle(matchObj)
{    
    return matchObj.matchNum + " (" + matchObj.player1Name + "-" + matchObj.player2Name + ")";
}

function getPlayoffMatchTitle(matchObj, matchNum)
{    
    return matchNum + " (" + matchObj.player1Name + "-" + matchObj.player2Name + ")";
}

function manageMatch1Scores()
{
    manageQualifyingRoundMatchScores(1);
}

function manageMatch2Scores()
{
    manageQualifyingRoundMatchScores(2);
}

function manageMatch3Scores()
{
    manageQualifyingRoundMatchScores(3);
}

function manageMatch4Scores()
{
    manageQualifyingRoundMatchScores(4);
}

function manageMatch5Scores()
{
    manageQualifyingRoundMatchScores(5);
}

function manageMatch6Scores()
{
    manageQualifyingRoundMatchScores(6);
}

function manageMatch7Scores()
{
    manageQualifyingRoundMatchScores(7);
}

function manageMatch8Scores()
{
    manageQualifyingRoundMatchScores(8);
}

function managePlayoff1Scores()
{
    if (playoffMatchesList.length < 1)
    {
        return;
    }
    
    managePlayoffMatchScores(1);
}

function managePlayoff2Scores()
{
    if (playoffMatchesList.length < 2)
    {
        return;
    }
    
    managePlayoffMatchScores(2);
}

function managePlayoff3Scores()
{
    if (playoffMatchesList.length < 3)
    {
        return;
    }
    
    managePlayoffMatchScores(3);
}

function startSemiFinals() 
{            
    if (tournament.state != 2) 
    {
        alert("Cannot start semi-finals because tournament isn't currently in qualifying round - it is currently in state: " + getTournamentStateLabel());
        return;
    }
    
    if (playersList.length < 4)
    {
        alert("There are only 3 players, so there can't be two rounds of playoffs.");
        return;
    }

    var errorString = finalizeQualifyingRoundMatches();
    
    if (errorString.length > 0) {
        return;
    }
        
    var confirmStr = prompt("You have requested start of semi-finals, all qualifying round matches appear to be complete - but please confirm that all scores have been validated and are correcxt.  Press ok to continue to semi-finals, otherwise press cancel.", "Confirmed");
    
    if (confirmStr == null || confirmStr != "Confirmed") 
    {
        return;
    }

    tournament.state = 3;
    tournament.nbrOfPlayoffRounds = 2;        
    
    var sortedMatchesList = clonePlayersList().sort(playersCompareToFunction);
    
    var playoffMatch1Obj = createMatch(tournament.compositeKey, 0, 3,     // Semi-finals 1
                                         sortedMatchesList[0],   // 1st seed
                                         sortedMatchesList[3]);  // 4th seed
    
    var playoffMatch2Obj = createMatch(tournament.compositeKey, 0, 3,     // Semi-finals 2
                                         sortedMatchesList[1],   // 2nd seed
                                         sortedMatchesList[2]);  // 3rd seed 
   
    playoffMatchesList.push(playoffMatch1Obj);
    playoffMatchesList.push(playoffMatch2Obj);
    
    // TODO - commit changes for newly scheduled matches, changes to player data, and updated tournament state.
    
    displayTournament();
}

function clonePlayersList()
{
    var clonedList = new Array();
    
    playersList.forEach(function(item, index, array) 
    {
        clonedList.push(item);
    }); 
    
    return clonedList;
}

function playersCompareToFunction(a,b) 
{
    if (a.derivedQualifyingScore < b.derivedQualifyingScore)
        return 1;
    if (a.derivedQualifyingScore > b.derivedQualifyingScore)
        return -1;
    return 0;
}

function startFinals() 
{            
    if (tournament.state != 2 || tournament.state == 3) 
    {
        alert("Cannot start finals because tournament isn't currently in qualifying round or semi-finals - it is currently in state: " + getTournamentStateLabel());
        return;
    }
    
    var confirmStr = prompt("You have requested start of finals while in qualifying round - this implies semi-finals will be skipped.  To skip semi-finals and proceed immediately to finals, press ok button, otherwise, press cancel.", "Confirmed");
    
    if (confirmStr == null || confirmStr != "Confirmed") 
    {
        return;
    }
  
    var semiFinalsWinnerPlayer1;
    var semiFinalsWinnerPlayer2;
  
    if (tournament.state == 2)
    {
        tournament.nbrOfPlayoffRounds = 1;   // When going from qualifier round to finals, there is obviously only 1 playoff round.
    
        finalizeQualifyingRoundMatches();
    }
    else {    
        // Verify semi final matches are complete (todo)  - set function variables semiFinalsWinnerPlayer1 and semiFinalsWinnerPlayer2
    }
    
    var playoffMatch1Obj;
    var playoffMatch2Obj;
    
    if (tournament.state == 3)  // If coming from semi-final round, then there is only a single final match to be scheduled.
    {        
        playoffMatch1Obj = createMatch(tournament.compositeKey, 0, 4,   // Finals match only
                                       semiFinalsWinnerPlayer1,
                                       semiFinalsWinnerPlayer2);  
                                       
        playoffMatchesList.push(playoffMatch1Obj);
    }
    else {
        var sortedMatchesList = clonePlayersList().sort(playersCompareToFunction);    
    
        playoffMatch1Obj = createMatch(tournament.compositeKey, 0, 4,      // Finals match
                                       sortedMatchesList[0],   // 1st seed
                                       sortedMatchesList[1]);  // 2rd seed  

        playoffMatchesList.push(playoffMatch1Obj);

        if (sortedMatchesList.length > 3)
        {
            playoffMatch2Obj = createMatch(tournament.compositeKey, 0, 2,  // Consolation match
                                           sortedMatchesList[2],   // 3rd seed
                                           sortedMatchesList[3]);  // 4th seed 
                                           
            playoffMatchesList.push(playoffMatch2Obj);
        }
    }

    tournament.state = 4;

    // TODO - commit changes for newly scheduled matches, changes to player data, and updated tournament state.
    
    displayTournament();
}

function closeTournament() 
{            
    if (tournament.state != 4) 
    {
        alert("Cannot close tournament because finals haven't been started yet - currently in state: " + getTournamentStateLabel());
        return;
    }
    
    alert("Transition to finals is not yet coded (coming soon)");
}

</script>

</head>

<body>

<table id="TournamentActions" cellspacing="15">
  <tr>
      <td> <p><button onclick="initializeTournament()" type="button">1. Select a tournament</button> ==>> </p> </td>
      <td> <p><button onclick="startTournament()" type="button">2. Start tournament</button>  ==>> </p> </td>
      <td> <p><button onclick="startSemiFinals()" type="button">3a. Start semi-finals</button>  ==>> </p> </td>
      <td> <p><button onclick="startFinals()" type="button">3b. Start finals</button>  ==>> </p> </td>
      <td> <p><button onclick="closeTournament()" type="button">4 Close tournament</button> </p> </td>
</table>


<div id="tournamentData"></div>

<div id="playerData"></div>

<table id="Matches" cellspacing="15">
  <tr>
      <td><u>Match #</u></td> <td><u>Match type</u></td> <td><u>Players</u></td> <td><u>Scores</u></td> 
  </tr>

  <tr id="Match1Row"  onclick="manageMatch1Scores()">
      <td id="Match1Cell1"></td> <td id="Match1CellMatchType"></td> <td id="Match1CellPlayers"></td> <td id="Match1CellScore"></td> 
  </tr>

  <tr id="Match2Row"  onclick="manageMatch2Scores()">
      <td id="Match2Cell1"></td> <td id="Match2CellMatchType"></td> <td id="Match2CellPlayers"></td> <td id="Match2CellScore"></td> 
  </tr>  
  
  <tr id="Match3Row"  onclick="manageMatch3Scores()">
      <td id="Match3Cell1"></td> <td id="Match3CellMatchType"></td> <td id="Match3CellPlayers"><td id="Match3CellScore"></td> 
  </tr>  

  <tr id="Match4Row"  onclick="manageMatch4Scores()">
      <td id="Match4Cell1"></td> <td id="Match4CellMatchType"></td> <td id="Match4CellPlayers"><td id="Match4CellScore"></td> 
  </tr>  

  <tr id="Match5Row"  onclick="manageMatch5Scores()">
      <td id="Match5Cell1"></td> <td id="Match5CellMatchType"></td> <td id="Match5CellPlayers"><td id="Match5CellScore"></td> 
  </tr>  

  <tr id="Match6Row"  onclick="manageMatch6Scores()">
      <td id="Match6Cell1"></td> <td id="Match6CellMatchType"></td> <td id="Match6CellPlayers"><td id="Match6CellScore"></td> 
  </tr>  

  <tr id="Match7Row"  onclick="manageMatch7Scores()">
      <td id="Match7Cell1"></td> <td id="Match7CellMatchType"></td> <td id="Match7CellPlayers"><td id="Match7CellScore"></td> 
  </tr>  

  <tr id="Match8Row"  onclick="manageMatch8Scores()">
      <td id="Match8Cell1"></td> <td id="Match8CellMatchType"></td> <td id="Match8CellPlayers"><td id="Match8CellScore"></td> 
  </tr>  

  <tr id="Playoff1Match"  onclick="managePlayoff1Scores()">
      <td id="PlayoffMatch1Cell1"></td> <td id="PlayoffMatch1MatchType"></td> <td id="PlayoffMatch1CellPlayers"><td id="PlayoffMatch1CellScore"></td> 
  </tr>  

  <tr id="Playoff2Match"  onclick="managePlayoff2Scores()">
      <td id="PlayoffMatch2Cell1"></td> <td id="PlayoffMatch2MatchType"></td> <td id="PlayoffMatch2CellPlayers"><td id="PlayoffMatch2CellScore"></td> 
  </tr> 
    
  <tr id="Playoff3Match"  onclick="managePlayoff3Scores()">
      <td id="PlayoffMatch3Cell1"></td> <td id="PlayoffMatch3MatchType"></td> <td id="PlayoffMatch3CellPlayers"><td id="PlayoffMatch3CellScore"></td> 
  </tr>  
  
</table>

<br>
<table id="DebuggingActions" cellspacing="15">
  <tr>
      <td> <p><button onclick="displayTournament()" type="button">Display tournament</button></p> </td>
      <td> <p><button onclick="clearAllLocalStorage()" type="button">clearAllLocalStorage</button></p> </td>
      <td> <p><button onclick="getAllLocalStorage()" type="button">getAllLocalStorage</button></p> </td>
      <td> <p><button onclick="dumpAllGlobalData()" type="button">Dump raw tournament data</button></p> </td>
</table>

<div id="appDebuggingData"></div>

</body>
</html>
 